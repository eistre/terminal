# Linux Terminal Exercise Environment

# Standard Helm values
nameOverride: ''
fullnameOverride: ''
imagePullSecrets: []

# Networking
networkPolicy:
  enabled: true # Requires NetworkPolicy-capable CNI (Calico, Cilium, etc.)

# General
general:
  nodeEnv: production # Options: development, test, production
  logLevel: info # Options: error, warn, info, debug, trace

# Authentication
auth:
  secret: '' # Required: 32+ characters
  userExpiryDays: 90

  admin:
    email: '' # Required
    password: '' # Required

  # Microsoft OAuth (Optional - first 3 fields required together or none)
  microsoft:
    clientId: ''
    clientSecret: ''
    tenantId: '' # Options: {tenant-id}, common, organizations, consumers
    labelEn: '' # Button label for English locale
    labelEt: '' # Button label for Estonian locale

  # Keycloak OIDC (Optional - first 3 fields required together or none)
  keycloak:
    clientId: ''
    clientSecret: ''
    issuer: '' # e.g., https://keycloak.example.edu/realms/your-realm
    labelEn: '' # Button label for English locale
    labelEt: '' # Button label for Estonian locale

# Mailer
mailer:
  type: noop # Options: noop, smtp
  maxRetries: 3
  concurrencyLimit: 10
  resendCooldownSeconds: 30
  sender: '' # Required when type: smtp

  # SMTP (required when type: smtp)
  smtp:
    host: ''
    port: ''
    secure: ''
    user: ''
    pass: ''

# Provisioner
provisioner:
  type: kubernetes # Options: kubernetes
  maxRetries: 3
  concurrencyLimit: 10
  containerExpiryMinutes: 30
  containerImage: ghcr.io/eistre/terminal-container:latest

  kubernetes:
    serviceType: headless # Options: headless, nodePort
    # headless: connects directly to pod IP
    # nodePort: creates NodePort service, connects via node IP
    cpuRequest: 100m
    cpuLimit: 250m
    memoryRequest: 64Mi
    memoryLimit: 128Mi

# Web application
web:
  image:
    registry: ghcr.io
    repository: eistre/terminal-web
    tag: latest
    pullPolicy: '' # Default: IfNotPresent (Always for 'latest' tag)

  replicaCount: 1 # Ignored when autoscaling.enabled is true

  autoscaling:
    enabled: false # Requires metrics-server in the cluster
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 80

  service:
    type: ClusterIP # Options: ClusterIP, NodePort, LoadBalancer
    port: 3000
    # nodePort: 30000
    annotations: {}
    sessionAffinity:
      enabled: true
      timeoutSeconds: 10800 # 3 hours, for WebSocket connections

  ingress:
    enabled: false
    className: ''
    annotations: {}
    hosts:
      - host: terminal.example.local
        paths:
          - path: /
            pathType: ImplementationSpecific
    tls: []
    # - secretName: terminal-tls
    #   hosts:
    #     - terminal.example.local

  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi

  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
  podLabels: {}

  podSecurityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    fsGroupChangePolicy: OnRootMismatch
    runAsNonRoot: true

  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    capabilities:
      drop:
        - ALL

  serviceAccount:
    create: true
    name: ''
    annotations: {}

# CronJobs
cronjobs:
  concurrencyPolicy: Forbid # Options: Forbid, Allow, Replace
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
  suspend: false
  backoffLimit: 2
  restartPolicy: OnFailure # Options: OnFailure, Never

  podSecurityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    fsGroupChangePolicy: OnRootMismatch
    runAsNonRoot: true

  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    capabilities:
      drop:
        - ALL

  # Database cleanup - removes expired sessions and inactive users
  databaseCleanup:
    image:
      registry: ghcr.io
      repository: eistre/terminal-database-cleanup
      tag: latest
      pullPolicy: '' # Default: IfNotPresent (Always for 'latest' tag)
    schedule: '0 0 * * *' # Every day at midnight
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 100m
        memory: 256Mi

  # Provisioner cleanup - removes expired terminal containers
  provisionerCleanup:
    image:
      registry: ghcr.io
      repository: eistre/terminal-provisioner-cleanup
      tag: latest
      pullPolicy: '' # Default: IfNotPresent (Always for 'latest' tag)
    schedule: '*/15 * * * *' # Every 15 minutes
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 100m
        memory: 256Mi
    serviceAccount:
      create: true
      name: ''
      annotations: {}

# Database
database:
  # Type of database deployment:
  # - internal: Deploy MariaDB as StatefulSet within the chart
  # - operator: Use MariaDB Operator (requires mariadb-operator installed in cluster)
  # - external: Connect to an external database (no deployment)
  type: internal

  # Database name (used by all types)
  name: terminal

  # Connection settings
  # When type: internal or operator, host is auto-generated from release name
  host: '' # Required when type: external
  port: 3306

  # Credentials (used by all types)
  credentials:
    user: terminal
    password: '' # Required
    rootPassword: '' # Required when type: internal or operator

  # Internal StatefulSet configuration (only used when type: internal)
  internal:
    image:
      registry: docker.io
      repository: mariadb
      tag: '12'
      pullPolicy: '' # Default: IfNotPresent (Always for 'latest' tag)

    persistence:
      enabled: true
      storageClass: '' # Empty: default provisioner, '-': disable dynamic provisioning
      accessMode: ReadWriteOnce
      size: 1Gi

    resources:
      requests:
        cpu: 300m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 1Gi

    nodeSelector: {}
    tolerations: []
    affinity: {}
    podAnnotations: {}
    podLabels: {}

    podSecurityContext:
      runAsUser: 999
      runAsGroup: 999
      fsGroup: 999
      fsGroupChangePolicy: OnRootMismatch
      runAsNonRoot: true

    containerSecurityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      capabilities:
        drop:
          - ALL

  # SSL/TLS configuration
  # Note: Not supported for 'internal' type - use 'operator' or 'external' for TLS support
  ssl:
    enabled: false
    # Custom CA secret for 'external' type with private CA
    # Ignored for 'operator' type (uses auto-generated secrets)
    caSecretName: ''
    caSecretKey: ca.crt

  # MariaDB Operator configuration (only used when type: operator)
  # Requires mariadb-operator to be installed in the cluster
  # See: https://github.com/mariadb-operator/mariadb-operator
  operator:
    storage:
      size: 1Gi
      storageClassName: '' # Empty: uses cluster default

    resources:
      requests:
        cpu: 300m
        memory: 128Mi
      limits:
        memory: 1Gi

    # MariaDB configuration (my.cnf style)
    myCnf: |
      [mariadb]
      bind-address=*
      default_storage_engine=InnoDB
      binlog_format=row
      innodb_autoinc_lock_mode=2
      max_allowed_packet=256M

    # Metrics exporter
    metrics:
      enabled: false

    # Labels used to identify the MariaDB Operator controller pods
    # Used for NetworkPolicy to allow operator access to managed databases
    controllerLabels:
      app.kubernetes.io/name: mariadb-operator
